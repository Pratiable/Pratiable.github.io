---
emoji: ğŸ’‰
title: Dependency Injection
date: '2021-08-29 16:09:38'
author: ì´ì¤€ì˜
tags: Design Pattern
categories: ë””ìì¸íŒ¨í„´
---

> â›”ï¸ ê³µë¶€í•˜ë©° ì •ë¦¬í•œ ë‚´ìš©ìœ¼ë¡œ ë‚´ìš©ìƒ ì •í™•í•˜ì§€ ì•Šì€ ë¶€ë¶„ì´ ìˆì„ ìˆ˜ ìˆìœ¼ë‹ˆ ì°¸ê³  ë¶€íƒë“œë¦½ë‹ˆë‹¤!
>
> ìˆ˜ì •ì´ í•„ìš”í•œ ë¶€ë¶„ì€ Comment ë‚¨ê²¨ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤!


# ì´ ê¸€ì„ ì“°ëŠ” ëª©ì ğŸ¤”

`Nest.js`ë¥¼ ê³µë¶€í•˜ë‹¤ ë³´ë‹ˆ `Django`ë¥¼ ê³µë¶€í•  ë•Œì™€ëŠ” ë‹¬ë¦¬ ì²˜ìŒë³´ëŠ” ê°œë…ë“¤ì´ ë„ˆë¬´ ë§ì•˜ëŠ”ë° ê·¸ ì¤‘ì—ì„œ Dependency Injectionì€ ê°€ì¥ ìì£¼ë‚˜ì˜¤ê³  ì•ìœ¼ë¡œ ë¬´ìŠ¨ ì–¸ì–´ & í”„ë ˆì„ì›Œí¬ë¡œ ê°œë°œì„ ì§„í–‰í•˜ë˜ì§€ ìƒê´€ì—†ì´ ì•Œì•„ì•¼ í•  í•„ìˆ˜ ê°œë…, OOPì„ ìœ„í•œ ë¶€ë¶„ ê°™ì•„ì„œ ê¸€ë¡œì¨ ì •ë¦¬í•´ë³´ê³ ì í•œë‹¤!

---
# Dependency Injection(ì˜ì¡´ì„± ì£¼ì…)ì´ë€?
ê°„ë‹¨í•˜ê²Œ ì„¤ëª…í•˜ìë©´ classê°„ì˜ ì˜ì¡´ì„±ì„ class ì™¸ë¶€ì—ì„œ ì£¼ì…í•˜ëŠ”ê²ƒì„ ë§í•˜ëŠ”ë° ì•„ë˜ì— í•˜ë‚˜ì”© ì ì–´ë³´ë©° ì´í•´í•´ ë³´ê¸°ë¡œ í•˜ì!

---
## ì˜ì¡´ì„±?
ì¼ë‹¨ ì˜ì¡´ì„±ì´ë€ ê°ì²´ë“¤ì´ ì„œë¡œ ì˜ì¡´ ê´€ê³„ë¥¼ ê°€ì§„ ì„±ì§ˆì´ë¼ê³  ê°„ë‹¨í•˜ê²Œ ì •ë¦¬ í•  ìˆ˜ ìˆë‹¤!

ê°ì²´ê°€ ë‘ ê°œê°€ ì¡´ì¬í•  ë•Œ í•œ ê°ì²´ê°€ ì¡´ì¬í•˜ë ¤ë©´ ë‹¤ë¥¸ í•˜ë‚˜ë¥¼ í•„ìš”ë¡œ í•  ë•Œ ì˜ì¡´ì„±ì´ ìƒê¸´ë‹¤ê³  í•  ìˆ˜ ìˆëŠ”ë°, ì¼ë‹¨
ì´í•´ê°€ ì˜ ì•ˆë˜ë‹ˆ ì•„ë˜ ì½”ë“œë¡œ ì¼ë‹¨ ì‚´í´ë³´ë„ë¡ í•˜ê² ë‹¤!

```typescript
class Dagger {
    attack () :string {
        return 'attacked with a Dagger!'
    }
};

class Rogue {
    private weapon: Dagger;

    constructor() {
        this.weapon = new Dagger();
    }

    public attackMonster() {
        return this.weapon.attack();
    }
}
```

ìœ„ ì½”ë“œë¥¼ ë³´ë©´ Rogue classëŠ” Dagger classë¥¼ ë‚´ë¶€ì—ì„œ ìƒˆë¡œ ìƒì„±í•˜ê²Œ ë˜ë©´ì„œ ì˜ì¡´ê´€ê³„ê°€ ìƒê¸°ê²Œ ë˜ë©°, weaponì„ ë³€ê²½í•˜ê³  ì‹¶ì–´ë„ ë‹¤ë¥¸ weaponìœ¼ë¡œ ë³€ê²½í•  ìˆ˜ ì—†ê²Œ ë˜ëŠ” ë¬¸ì œê°€ ìˆë‹¤!

ì´ëŸ° ê²½ìš°ì— `Tight Coupling(ê°•í•œ ê²°í•©)`ì´ ì¼ì–´ë‚˜ê²Œ ë˜ëŠ”ë° ì´ëŸ° ê²½ìš°ì— Dagger classë¥¼ ë³€ê²½í•˜ê²Œ ëœë‹¤ë©´ ë‹¹ì—°í•˜ê²Œë„ Rouge classê¹Œì§€ ì˜í–¥ì„ ë¯¸ì¹˜ê²Œ ëœë‹¤.

ê²°êµ­ í•˜ë‚˜ì˜ ê°ì²´ê°€ ìˆ˜ì •ë˜ì—ˆì„ ë•Œ ê·¸ ê°ì²´ë¥¼ ì˜ì¡´í•˜ê³  ìˆëŠ” ë‹¤ë¥¸ ê°ì²´ê¹Œì§€ ìˆ˜ì •ë˜ì–´ì•¼ í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ê³  Unit Test ì‘ì„±ë„ ì–´ë ¤ì›Œì§„ë‹¤.

---
## ì£¼ì…ì€?

ìœ„ì— ì½”ë“œì—ì„œëŠ” ê°ì²´ ë‚´ë¶€ì—ì„œ ë˜ ë‹¤ë¥¸ ê°ì²´ë¥¼ ìƒì„±í•´ì„œ ì‚¬ìš©í–ˆëŠ”ë° ì™¸ë¶€ì—ì„œ ê°ì²´ë¥¼ ìƒì„±í•´ì„œ ë‹¤ë¥¸ ê°ì²´ì—ê²Œ ë„£ì–´ì£¼ëŠ” ê²ƒì„ ëœ»í•œë‹¤.

ì£¼ì…í•˜ëŠ” ë°©ë²•ì€
1. Field Injection
2. Function(Setter) Injection
3. Constructor Injection

ì„¸ ê°€ì§€ê°€ ìˆëŠ”ë° ìœ„ ì„¸ ê°€ì§€ ë°©ë²•ì¤‘ì— Constructorë¥¼ í†µí•´ì„œ ì£¼ì…í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ ì§„í–‰í•´ ë³´ë„ë¡ í•˜ê² ë‹¤.

```typescript
interface Weapon {
    attack(): string;
};

class Dagger implements Weapon {
    attack() {
        return 'attacked with a Dagger!';
    };
};

class Bow implements Weapon {
    attack() {
        return 'attacked with a Bow!';
    };
};

class Rogue {
    private weapon: Weapon;

    constructor(weapon: Weapon) {
        this.weapon = weapon;
    };

    public attackMonster() {
        return this.weapon.attack();
    };
};

const rangedRogue = new Rogue(new Bow);
const meleeRogue = new Rogue(new Dagger);

console.log(rangedRogue.attackMonster())
console.log(meleeRogue.attackMonster())

// "attacked with a Bow!"
// "attacked with a Dagger!" 
```

ìœ„ ì½”ë“œë¥¼ ë³´ë©´ Rogueê°ì²´ëŠ” ì˜ì¡´í•˜ëŠ” typeë§Œ ì•Œê³ ìˆê³ , ë§¤ê°œë³€ìˆ˜ë¡œ ì •í•´ì§„ type(ì˜ˆì œì—ì„œëŠ” Weapon)ì„ ì „ë‹¬í•˜ê²Œ ë˜ë©´ ì–´ëŠê²ƒì´ ë“¤ì–´ì˜¤ë˜ì§€ ë¬¸ì œ ì—†ì´ ê°ì²´ë¥¼ ìƒì„±í•  ìˆ˜ ìˆê²Œ ëœë‹¤. ì´ë ‡ê²Œ ì½”ë“œë¥¼ ì‘ì„±í•˜ë©´ ì˜ì¡´ì„±ì´ í•´ì†Œë  ìˆ˜ ìˆë‹¤.

í•˜ì§€ë§Œ ì—¬ê¸°ì„œ ì˜ì¡´ì„±ì´ í•´ì†Œë˜ì—ˆë‹¤ê³  ëì´ ì•„ë‹ˆë¼ ì•Œì•„ì•¼ë  í•œ ê°€ì§€ì˜ ê°œë…ì´ ë” ì¡´ì¬í•œë‹¤.

---
## Inversion of Control(ì œì–´ì˜ ì—­ì „)
IoCëŠ” ê°ì²´ì˜ ìƒì„±ì´ë‚˜ Lifecycleì˜ ê´€ë¦¬ê¹Œì§€ ëª¨ë“  ê°ì²´ì— ëŒ€í•œ ì œì–´ê¶Œì´ ë°”ë€Œì—ˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•˜ëŠ” Design patternì´ë‹¤.

ì´ê²ƒì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ì„œëŠ” IoC Containerê°€ í•„ìš”í•œë° ì´ ì—­í• ì„ Frameworkê°€ í•´ì¤„ ìˆ˜ ìˆë‹¤.

ê²°êµ­ Frameworkì—ì„œ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì— ê°ì²´ë¥¼ ì£¼ì…í•´ì„œ ê°œë°œìê°€ ì‹ ê²½ì¨ì•¼ í•  ì½”ë“œë¥¼ ì¤„ì´ëŠ” ë°©ë²•ì´ë‹¤.

> IoC ContainerëŠ” Factory Patternê³¼ í˜¼ë™í•´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ê³  í•œë‹¤.
> 
> ê¸°ë³¸ì ìœ¼ë¡œ FactoryëŠ” ë‹¨ìˆœíˆ ê°ì²´ë¥¼ ìƒì„±í•˜ê²Œ ë˜ì§€ë§Œ IoC Containerë¥¼ ì‚¬ìš© ì‹œ IoCì˜ ê°œë…ì´ ì ìš©ë˜ì–´ì•¼ í•œë‹¤.
> 
> IoC Containerë¥¼ ì‚¬ìš©í•œë‹¤ê³  í•´ì„œ ê·¸ëƒ¥ IoCê°€ ì¼ì–´ë‚˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ëŠ” ëœ».

Nest.jsì˜ ì˜ˆì œë¥¼ í•˜ë‚˜ í™•ì¸í•´ë³´ì!

```typescript
@Injectable()
export class AccountsService {
    constructor(
        @InjectRepository(Account) private accountRepository: Repository<Account>,
    ) {
    }

    async findAccount(user_account: string): Promise<Account | null> {
        const account = await this.accountRepository.findOne({user_account});

        if (!account) {
            throw new UnauthorizedException('INVALID_ACCOUNT');
        }

        return account;
    }
}
```

ìœ„ ì½”ë“œì—ì„œ AccountsServiceì˜ ìƒì„±ìì— accountRepository ë¶€ë¶„ì„ ë³´ê²Œë˜ë©´ typeë§Œ ì§€ì •í•´ ì¤¬ëŠ”ë°ë„ ì•„ë˜ findAccountë¶€ë¶„ì—ì„œ accountRepositoryì˜ findOneì´ë¼ëŠ” methodë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤.

ì´ê²ƒì´ ê°€ëŠ¥í•œ ì´ìœ ëŠ” Nest.jsì—ì„œ accountRepositoryì˜ typeì„ ë³´ê³  Repository íƒ€ì…ì„ ì•Œì•„ì„œ í• ë‹¹í•´ì¤¬ê¸° ë•Œë¬¸ì´ë‹¤.

ê·¸ë˜ì„œ ê°œë°œìëŠ” ìœ„ ê°ì²´ì˜ Lifecycleì„ ì‹ ê²½ì“°ì§€ ì•Šì•„ë„ í¸í•˜ê²Œ ì‚¬ìš©í•˜ë©´ ë˜ëŠ”ë° ì´ë ‡ê²Œ ìƒì„±ëœ ê°ì²´ëŠ” Nest.jsì—ì„œ ìë™ìœ¼ë¡œ ê´€ë¦¬ë¥¼ í•´ì£¼ê¸° ë•Œë¬¸ì´ë‹¤.

---

## Dependency Injectionì˜ ì¥ë‹¨ì 

ì§€ê¸ˆê¹Œì§€ Dependency Injectionì— ëŒ€í•´ì„œ ì—¬ëŸ¬ ì˜ˆì œì™€ í•¨ê»˜ ì‚´í´ ë´¤ëŠ”ë° Dependency Injectionì˜ ì¥ë‹¨ì ì— ëŒ€í•´ ì§§ê²Œ ì •ë¦¬í•´ë³´ë ¤ê³  í•œë‹¤.

### ì¥ì 
1. ê°€ë…ì„±ê³¼ ì½”ë“œì˜ ì¬ì‚¬ìš©ì„±ì„ ë†’ì—¬ì¤Œ
2. ì¢…ì†ì„±ì´ ê°ì†Œí•˜ê¸° ë•Œë¬¸ì— ë³€ê²½ì— ë¯¼ê°í•˜ì§€ ì•Šê²Œ ë¨
3. ê°ì²´ê°„ì˜ ê²°í•©ë„ë¥¼ ë‚®ì¶°ì£¼ê¸° ë•Œë¬¸ì— ìœ ì—°í•œ ì½”ë“œì‘ì„±ì´ ê°€ëŠ¥í•´ì§
4. ê°ì²´ë“¤ì´ ë¶„ë¦¬ë˜ì–´ ìˆì–´ì„œ Test Caseì‘ì„± ì‹œ íš¨ìœ¨ì ì„
5. Lifecycleë³„ë¡œ Containerë¥¼ ê´€ë¦¬í•´ì„œ ë¦¬ì†ŒìŠ¤ì˜ ë‚­ë¹„ë¥¼ ì¤„ì¼ ìˆ˜ ìˆìŒ

### ë‹¨ì 
1. DIë¥¼ ìœ„í•´ì„œ ë”°ë¡œ ì‘ì—…ì„ í•´ì£¼ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ê°„ë‹¨í•œ ì½”ë“œë¥¼ ì‘ì„±í•  ë• ë²ˆê±°ë¡œìš¸ ìˆ˜ ìˆìŒ
2. ë™ì‘, êµ¬ì„±ì„ ë¶„ë¦¬í•˜ê¸° ë•Œë¬¸ì— ì½”ë“œ ì¶”ì ì´ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŒ

---
## ë§ˆì¹˜ë©°ğŸ‰
DIë¥¼ ì²˜ìŒ ì ‘í•  ë• ëª¨ë¥´ëŠ” ë¶€ë¶„ì´ ë§ì•˜ê¸° ë•Œë¬¸ì— í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë©° ì´ê²Œ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ ìƒê°í•  ì‹œê°„ì´ ë„ˆë¬´ ì—†ê³  ì‘ë™ì´ ë˜ëŠ” ì½”ë“œë§Œ ì‘ì„±í•˜ê¸°ì— ê¸‰ê¸‰í–ˆë˜ ê²ƒ ê°™ì€ë°
ê·¸ë˜ë„ ì´ë²ˆ ë¸”ë¡œê·¸ ê¸€ì„ ì •ë¦¬í•˜ë©´ì„œ DIì— ëŒ€í•´ ë§ì´ ë°°ìš´ ê²ƒ ê°™ë‹¤.

Frameworkì—ì„œ DIë¥¼ í•´ì¤€ë‹¤ê³  í•´ì„œ ë„ˆë¬´ Frameworkì— ì˜ì¡´í•˜ì§€ ì•Šê³  ì–´ë–»ê²Œ í•˜ë©´ ë‚´ ì½”ë“œì—ì„œë¶€í„° ì˜ì¡´ì„±ì„ ì¤„ì—¬ ë‚˜ê°ˆ ìˆ˜ ìˆì„ê¹Œ ê³ ë¯¼í•´ë´ì•¼ê² ë‹¤.

í•˜ì§€ë§Œ ë¬¸ì œëŠ” ì´ë ‡ê²Œ ê³µë¶€í•˜ê³  ë‚˜ë‹ˆ ë˜ ëª¨ë¥´ëŠ” ê°œë…ë“¤ì´ ìŸì•„ì ¸ì„œ ì•ìœ¼ë¡œë„ ë§ì€ í•™ìŠµì´ í•„ìš”í•  ê²ƒ ê°™ì€ë° ê·¸ëŸ° ë¶€ë¶„ë“¤ë„ ì¶”ê°€ë¡œ ë¸”ë¡œê·¸ ê¸€ë¡œ ì •ë¦¬í•´ì•¼ í•  ë“¯ í•˜ë‹¤ğŸ˜‚

>ğŸ›  _ë¶€ì¡±í•œ ë¶€ë¶„ë“¤ì€ ì§€ì†ì ìœ¼ë¡œ ìˆ˜ì • ì˜ˆì •!_

---
ì•ìœ¼ë¡œ ê³µë¶€í•´ì•¼ í•  ê²ƒë“¤ğŸ¤™ğŸ»
- Singleton Pattern
- Factory Pattern
- etc....




---
**References**

[ì¶œì²˜1](https://medium.com/lemonade-engineering/node-js%EB%A1%9C-%EC%84%A4%EB%AA%85%ED%95%98%EB%8A%94-di-b4a8acf9ce25)

[ì¶œì²˜2](https://medium.com/@jang.wangsu/di-dependency-injection-%EC%9D%B4%EB%9E%80-1b12fdefec4f)

[ì¶œì²˜3](https://develogs.tistory.com/19)

```toc
```