{"componentChunkName":"component---src-templates-blog-template-js","path":"/nest-unittest-using-jest-1/","result":{"data":{"cur":{"id":"bccb5241-04d2-5b26-8a37-c245cf6eb7ee","html":"<h1 id=\"nestjs에서의-unit-test\" style=\"position:relative;\"><a href=\"#nestjs%EC%97%90%EC%84%9C%EC%9D%98-unit-test\" aria-label=\"nestjs에서의 unit test permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Nest.js에서의 unit-test</h1>\n<p>Nest.js는 기본 테스트 라이브러리로 jest를 지원하고 있다. CLI로 서비스나 컨트롤러를 생성할 때 파일명 뒤에 <code class=\"language-text\">spec.ts</code>가 붙은 파일이 테스트를 위해 자동으로 생성된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Test<span class=\"token punctuation\">,</span> TestingModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/testing'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> UsersService <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./users.service'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'UsersService'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> service<span class=\"token operator\">:</span> UsersService<span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> module<span class=\"token operator\">:</span> TestingModule <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> Test<span class=\"token punctuation\">.</span><span class=\"token function\">createTestingModule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      providers<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>UsersService<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">compile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    service <span class=\"token operator\">=</span> module<span class=\"token punctuation\">.</span>get <span class=\"token operator\">&lt;</span> UsersService <span class=\"token operator\">></span> UsersService<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should be defined'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>service<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeDefined</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<blockquote>\n<p>spec.ts가 생성되었을 때 기본 코드</p>\n</blockquote>\n<hr>\n<h2 id=\"jest란\" style=\"position:relative;\"><a href=\"#jest%EB%9E%80\" aria-label=\"jest란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Jest란?</h2>\n<p>일단 Nest.js의 unit-test를 작성하기 전에 Jest에 대해서 알아볼 필요가 있다고 생각한다.</p>\n<p>Jest는 Facebook에서 만든 테스트 라이브러리이고 Jest가 나오기 이전에 javascript 코드를 테스트하기 위해서는 여러 가지 테스트 라이브러리들을 설치해서 서로 조합해서 사용해야 했는데 Jest를 사용할 경우에는 많은 기능을 한 번에 지원하기 때문에 효과적인 테스트 라이브러리라고 할 수 있다.</p>\n<p>테스트 코드가 직관적이기도 하고 문서화도 잘 되어있어 생산성, 가독성 면에서도 효과적이다!</p>\n<hr>\n<h2 id=\"nestjs에서의-jest를-활용한-mocking\" style=\"position:relative;\"><a href=\"#nestjs%EC%97%90%EC%84%9C%EC%9D%98-jest%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%9C-mocking\" aria-label=\"nestjs에서의 jest를 활용한 mocking permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Nest.js에서의 Jest를 활용한 Mocking</h2>\n<p>이제 Nest.js에서의 Jest를 활용한 Mocking을 진행해 볼 텐데 그 전에 일단 Mocking이 뭔지 간단하게 정리해보겠다.</p>\n<h3 id=\"mocking\" style=\"position:relative;\"><a href=\"#mocking\" aria-label=\"mocking permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Mocking?</h3>\n<p>Mocking은 단위 test를 작성할 때 해당 코드가 의존하고 있는 부분을 가짜로 대체하는 기법을 말한다. 일반적으로 테스트할 코드가 의존하는 부분을 직접 생성하기 어려운 경우 mocking이 많이 활용된다!</p>\n<p>Mocking을 하지 않고 실제 환경과 같이 테스트 환경을 설정하게 됐을 때 실제 db를 사용한다면 여러 문제점이 발생될 수 있는데</p>\n<ul>\n<li>db 접속과 같이 network이나 I/O 작업이 포함된 테스트는 실행 속도가 느려짐</li>\n<li>CI/CD의 일부에 테스트가 자동화되어 있다면 속도가 느려서 문제가 생길 수 있음</li>\n<li>테스트 자체를 위한 코드보다 db와 연결하고 트랜잭션 생성, 쿼리 전송하는 코드가 더 길어질 수 있음</li>\n<li>테스트 실행 순간 db가 오프라인 된다면 테스트는 실패하고 테스트 자체가 인프라 환경에 영향을 받음</li>\n</ul>\n<p>위와 같은 문제 말고도 여러 가지 크고 작은 문제들이 발생할 수 있고, 특정 기능만 분리해서 테스트하겠다는 <strong>unit test의 목적에 부합하지 않게</strong>된다.</p>\n<p>Mocking은 이런 상황에서 실제 객체처럼 사용 가능한 가짜 객체를 생성하는 메커니즘 제공 및 테스트 실행 중 가짜 객체에 어떤 일들이 발생했는지 기억하고 있기 때문에 내부적으로 이 객체가 어떻게 사용되는지 검증이 가능하다.</p>\n<hr>\n<h3 id=\"mocking으로-테스트-환경-준비\" style=\"position:relative;\"><a href=\"#mocking%EC%9C%BC%EB%A1%9C-%ED%85%8C%EC%8A%A4%ED%8A%B8-%ED%99%98%EA%B2%BD-%EC%A4%80%EB%B9%84\" aria-label=\"mocking으로 테스트 환경 준비 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Mocking으로 테스트 환경 준비</h3>\n<p>Mocking이 어떤 건지 간단하게 알아봤으니 실제 jest에서 어떻게 mocking으로 unit-test 환경을 준비할지 코드로 확인해 보자!</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> mockUserRepository <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  save<span class=\"token operator\">:</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  findOne<span class=\"token operator\">:</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/* \nMockRepository를 type alias로 정의하고 Partial, Record등의 유틸리티 클래스를 사용하여 repository를 mocking할 준비를 한다.\nRecord를 사용하여 Repository&lt;T>의 메서드를 추출한 값을 key값 타입으로, jest.Mock을 value값으로 갖는 타입을 리턴한다.\n그리고 Repository의 메서드를 전부 사용할 것이 아니기 때문에 Partial을 사용해서 메서드를 optional하게 가져왔다.\n*/</span>\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">MockRepository<span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span> <span class=\"token operator\">=</span> <span class=\"token builtin\">any</span><span class=\"token operator\">></span></span> <span class=\"token operator\">=</span> Partial<span class=\"token operator\">&lt;</span>Record<span class=\"token operator\">&lt;</span><span class=\"token keyword\">keyof</span> Repository<span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> jest<span class=\"token punctuation\">.</span>Mock<span class=\"token operator\">>></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'UsersService'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> service<span class=\"token operator\">:</span> UsersService<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> userRepository<span class=\"token operator\">:</span> MockRepository<span class=\"token operator\">&lt;</span>User<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> module<span class=\"token operator\">:</span> TestingModule <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> Test<span class=\"token punctuation\">.</span><span class=\"token function\">createTestingModule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      providers<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        UsersService<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span> provide<span class=\"token operator\">:</span> <span class=\"token function\">getRepositoryToken</span><span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> useValue<span class=\"token operator\">:</span> mockUserRepository <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//custom provider</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">compile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    service <span class=\"token operator\">=</span> module<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>UsersService<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>UsersService<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    userRepository <span class=\"token operator\">=</span> module<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>MockRepository<span class=\"token operator\">&lt;</span>User<span class=\"token operator\">>></span></span></span><span class=\"token punctuation\">(</span><span class=\"token function\">getRepositoryToken</span><span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should be defined'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>service<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeDefined</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">MockRepository</code>를 활용하여 <code class=\"language-text\">Repository</code>를 Mocking</li>\n<li>여기서 mocking할 Repository는 하나이기 때문에 <code class=\"language-text\">mockUserRepository</code>를 object 형태로 작성해뒀지만 여러 repository를 mocking하는 경우에는 함수로 작성해 주는 게 좋다.</li>\n<li><code class=\"language-text\">mockUserRepository</code>에서 현재 사용할 메서드는 <code class=\"language-text\">save</code>와 <code class=\"language-text\">findOne</code>이기 때문에 두 메서드를 <code class=\"language-text\">jest.fn</code>을 사용해서 메서드를 mocking해줬다.</li>\n<li><code class=\"language-text\">getRepositoryToken</code>을 custom provider로 사용했는데 <code class=\"language-text\">@InjectRepository()</code>를 사용하여 <code class=\"language-text\">UsersRepository</code>를 요청할 때마다 <code class=\"language-text\">useValue</code>로 등록된 <code class=\"language-text\">mockUserRepository</code>객체를 사용하게 된다.</li>\n</ul>\n<p>위처럼 설정해두면 mocking은 완료됐고 테스트 코드를 작성할 때 db에 직접 접속하게 되는 것이 아니라 mocking한 repository를 호출하게 된다.</p>\n<hr>\n<h3 id=\"unit-test-작성해보기\" style=\"position:relative;\"><a href=\"#unit-test-%EC%9E%91%EC%84%B1%ED%95%B4%EB%B3%B4%EA%B8%B0\" aria-label=\"unit test 작성해보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>unit-test 작성해보기</h3>\n<p>그럼 유저를 생성하는 함수를 테스트하는 코드를 작성해보자!</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'createUser'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> createUserArguments <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    email<span class=\"token operator\">:</span> <span class=\"token string\">'test@test.co.kr'</span><span class=\"token punctuation\">,</span>\n    password<span class=\"token operator\">:</span> <span class=\"token string\">'rhrlrkr1234'</span><span class=\"token punctuation\">,</span>\n    name<span class=\"token operator\">:</span> <span class=\"token string\">'tester'</span><span class=\"token punctuation\">,</span>\n    phoneNumber<span class=\"token operator\">:</span> <span class=\"token string\">'010-1234-1234'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should create user'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    userRepository<span class=\"token punctuation\">.</span>findOne<span class=\"token punctuation\">.</span><span class=\"token function\">mockResolvedValue</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    userRepository<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">.</span><span class=\"token function\">mockResolvedValue</span><span class=\"token punctuation\">(</span>createUserArguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> service<span class=\"token punctuation\">.</span><span class=\"token function\">createUser</span><span class=\"token punctuation\">(</span>createUserArguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>userRepository<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledTimes</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>userRepository<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledWith</span><span class=\"token punctuation\">(</span>createUserArguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> success<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">createUserArguments</code>부분은 유저 생성을 위해서 미리 작성해둔 arguments이고 아래에서 mocking한 함수를 사용할 때 이 값을 넣어서 호출하면 된다.</li>\n<li><code class=\"language-text\">mockResolvedValue</code>는 promise를 반환할 때 사용하는데 <code class=\"language-text\">save</code>는 <code class=\"language-text\">promise&lt;User></code>를 반환하기 때문에 인자로 <code class=\"language-text\">createUserArguments</code>를 설정해 줬다.</li>\n<li><code class=\"language-text\">toHaveBeenCalledTimes</code>를 사용하게 된다면 해당 method가 몇 번 호출되었는지 체크할 수 있다.</li>\n<li><code class=\"language-text\">toHaveBeenCalledWith</code>은 위와 비슷하게 어떤 인자를 받았는지 체크할 수 있다.</li>\n<li>마지막으로 createUser의 return값이 정상적으로 나오는지 체크한다.</li>\n</ul>\n<hr>\n<h3 id=\"unit-test가-정상-작동하는지-확인하기\" style=\"position:relative;\"><a href=\"#unit-test%EA%B0%80-%EC%A0%95%EC%83%81-%EC%9E%91%EB%8F%99%ED%95%98%EB%8A%94%EC%A7%80-%ED%99%95%EC%9D%B8%ED%95%98%EA%B8%B0\" aria-label=\"unit test가 정상 작동하는지 확인하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>unit-test가 정상 작동하는지 확인하기</h3>\n<p>현재 내가 테스트할 부분은 user의 service내 로직을 테스트할 것이기 때문에 <code class=\"language-text\">npm run test user.service</code>명령어를 터미널에 실행하게 되면 <code class=\"language-text\">user.service</code>을 테스트할 수 있게 된다.</p>\n<p>명령어를 실행하고 기다리게 되면!!!!</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAABBElEQVQY001QzU6GMBDkOYwg2PJXQFTCZ7At+hUkfBcTE08mnjx68eLBGC8+hY/g6xgfaOxWMRwmu7Pbnc6u9/pxh8f3G4i8QFVVqOsaZVlCKYV5ntH3PcZxdDDGYBgGTNMEJSWO2xaf9w/4en7D99MLbqWGt7secLW7tIMX2Jxt0HUd8jxHmqYQQiDLMscprvM4jsE4Q5sLqPLIokLGY3jcFk+bE2ilIe2vTdOgKAoHGqa4iBNnjMH3fYRh6LAfBNgLfIsAB5Z79ECqc7uKwXZroLV2DqhOLjjnv24sJ+GlRmJRFDkc/oFyjxqMR8gEuSj+V6J7Li4pT5LERbov9deCa/wAtOWccAN0RS8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"test-result\"\n        title=\"test-result\"\n        src=\"/static/f29e5a20db62fe0b334876501b5c1ffc/37523/createUser-unit-test-result.png\"\n        srcset=\"/static/f29e5a20db62fe0b334876501b5c1ffc/e9ff0/createUser-unit-test-result.png 180w,\n/static/f29e5a20db62fe0b334876501b5c1ffc/f21e7/createUser-unit-test-result.png 360w,\n/static/f29e5a20db62fe0b334876501b5c1ffc/37523/createUser-unit-test-result.png 720w,\n/static/f29e5a20db62fe0b334876501b5c1ffc/dc333/createUser-unit-test-result.png 938w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>이렇게 정상적으로 테스트가 완료된 것을 볼 수 있다!</p>\n<p>만약 테스트가 실패하게 되는 경우에는\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACWUlEQVQ4y21Ta2/bMAz0/9jil2T5IfkR20mcxHGatEODFOhWYMD+/y+5HdV1A7Z9OFCkRepInoNlOeHx6Yrr9Yrz+Yzj8eihlIIxxiPLst9WoLVGHMdIkuQfBEkaoe4q9P2AcRjQdR3quoa11sM55/2iKJDnufflHEWRL/B34UCY7HcTHk4nnJfFM91Pk//o2fB7mqbIyErOwk4g35L/sAw+86UwDJHR0XzZEEpapW3JtqgqxnNUTY1EWhaWZKxzg0/M8/lx5K0gcDrDvqww5AX2RYk+yzGaAjXjigxa2g39rclxKCofF2YDfcmbGGszg5H5O+YHp9Lia93h1bX41qzxQnsnzrxoU4UvtsYb429tjx/d4OMqinGvW3xn/LlymPPS1xAEUZqgbBq4dYdM2is5fGdRcPiWreVcjGIs4twK3mv7Hj2Xl7Llsm3RDD0s45IrNQIZtizjgZIRO1Myu+0Wh/2E+XDAdhzp72CZsN1scGTscDiiY7GZd5Z59nc2fEiWG8jaV6uVl4EsR86CWBskVY1Qaa/BkgUrQqQThyu/uJSjSWQEbDtj+6lW7wVTykE0J1IQiSQs3lyeMd5esSGbx8sFL/c7brcbLtcntK7y7dePL8j7LTLOt5gWuG6NQFMuBds2fFk0+SFWzWW49YDpOGNHbIjTwvZ6i3HNGWcx8uQzrImZH6PUoY8FhoxEOjELfRQURNIWFZDaBjnbck0PxUUMTqGvNcbWYN0YdC7zGHhurOaWySb6VUz+gA+Gwjhm63EUIqWvKF6Jh5RMGHLu4bv1fvTn/BOk5IURAklbYwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"test-fail-result\"\n        title=\"test-fail-result\"\n        src=\"/static/0ad860950c582fff24bde4273b5f9c8e/37523/createUser-unit-test-fail-result.png\"\n        srcset=\"/static/0ad860950c582fff24bde4273b5f9c8e/e9ff0/createUser-unit-test-fail-result.png 180w,\n/static/0ad860950c582fff24bde4273b5f9c8e/f21e7/createUser-unit-test-fail-result.png 360w,\n/static/0ad860950c582fff24bde4273b5f9c8e/37523/createUser-unit-test-fail-result.png 720w,\n/static/0ad860950c582fff24bde4273b5f9c8e/c1c45/createUser-unit-test-fail-result.png 824w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>이렇게 어느 테스트에서 실패했는지, 어떤 로직에서 다른지 등등 자세하게 표시해 줘서 어떤 것이 문제인지 빠르게 파악할 수 있다.</p>\n<hr>\n<h3 id=\"마치며\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\" aria-label=\"마치며 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마치며</h3>\n<p>Jest를 사용하면 unit-test를 확실히 쉽게 할 수 있는 장점이 있다. 현재 예전에 진행했던 프로젝트를 django에서 nest.js로 마이그레이션 하고 있는데 unit-test를 확실하게 작성하며 진행하려고 하다 보니 인턴십을 진행할 때는 보지 못했던 디테일한 함수의 사용법 등을 다시 확인하게 되었다. 아직 이번 글에서 소개하지 못한 jest의 여러 기능들이 존재하는데 그런 부분들은 앞으로 코드 작성을 하면서 블로그에 다른 글로 정리해 볼 것이다!</p>\n<p>정보에 잘못된 부분이 있다면 댓글로 피드백 주시면 확인 후 수정하도록 하겠습니다!😃</p>\n<br>\n<br>\n<br>\n<br>\n<br>\n<hr>\n<p><strong>ref.</strong></p>\n<p><a href=\"https://www.daleseo.com/jest-fn-spy-on/\">출처 1</a>\n<a href=\"https://darrengwon.tistory.com/1004?category=915252\">출처 2</a></p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#jest%EB%9E%80\">Jest란?</a></li>\n<li>\n<p><a href=\"#nestjs%EC%97%90%EC%84%9C%EC%9D%98-jest%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%9C-mocking\">Nest.js에서의 Jest를 활용한 Mocking</a></p>\n<ul>\n<li><a href=\"#mocking\">Mocking?</a></li>\n<li><a href=\"#mocking%EC%9C%BC%EB%A1%9C-%ED%85%8C%EC%8A%A4%ED%8A%B8-%ED%99%98%EA%B2%BD-%EC%A4%80%EB%B9%84\">Mocking으로 테스트 환경 준비</a></li>\n<li><a href=\"#unit-test-%EC%9E%91%EC%84%B1%ED%95%B4%EB%B3%B4%EA%B8%B0\">unit-test 작성해보기</a></li>\n<li><a href=\"#unit-test%EA%B0%80-%EC%A0%95%EC%83%81-%EC%9E%91%EB%8F%99%ED%95%98%EB%8A%94%EC%A7%80-%ED%99%95%EC%9D%B8%ED%95%98%EA%B8%B0\">unit-test가 정상 작동하는지 확인하기</a></li>\n<li><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\">마치며</a></li>\n</ul>\n</li>\n</ul>\n</div>","excerpt":"Nest.js에서의 unit-test Nest.js는 기본 테스트 라이브러리로 jest를 지원하고 있다. CLI로 서비스나 컨트롤러를 생성할 때 파일명 뒤에 가 붙은 파일이 테스트를 위해 자동으로 생성된다. spec.ts가 생성되었을 때 기본 코드 Jest란? 일단 Nest.js의 unit-test를 작성하기 전에 Jest에 대해서 알아볼 필요가 있다고 생각한다. Jest는 Facebook에서 만든 테스트 라이브러리이고 Jest가 나오기 이전에 javascript 코드를 테스트하기 위해서는 여러 가지 테스트 라이브러리들을 설치해서 서로 조합해서 사용해야 했는데 Jest를 사용할 경우에는 많은 기능을 한 번에 지원하기 때문에 효과적인 테스트 라이브러리라고 할 수 있다. 테스트 코드가 직관적이기도 하고 문서화도 잘 되어있어 생산성, 가독성 면에서도 효과적이다! Nest.js에서의 Jest를 활용한 Mocking 이제 Nest.js에서의 Jest를 활용한 Mocking을 진행해 볼 텐데…","frontmatter":{"date":"September 25, 2021","title":"Jest로 Nest.js 유닛테스트 해보기!","categories":"Testing","author":"이준영","emoji":"🧪"},"fields":{"slug":"/nest-unittest-using-jest-1/"}},"next":{"id":"3e933c34-65fa-579a-9583-7952a371df45","html":"<h1 id=\"database란\" style=\"position:relative;\"><a href=\"#database%EB%9E%80\" aria-label=\"database란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Database란?</h1>\n<ul>\n<li>일반적으로 컴퓨터 시스템에 저장된 정보 또는 데이터의 집합</li>\n<li>DBMS(<code class=\"language-text\">데이터베이스 관리 시스템</code>)으로 제어</li>\n<li>데이터와 DBMS는 연관된 어플리케이션들과 함께 <code class=\"language-text\">데이터베이스 시스템</code>으로 일컬어지며 더 짧게는 데이터베이스라고 통칭되기도 함</li>\n<li>어플리케이션에서는 데이터가 메모리상에 존재하고 <strong>메모리에 존재하는 데이터는 보존이 되지 않기 때문</strong>에 애플리케이션이 종료되면 메모리에 있던 데이터들은 다시 읽어들일 수 없어서 데이터를\n<strong>오랜기간 저장 및 보존하기 위해</strong>서 데이터베이스라고 통칭</li>\n<li>\n<h2 id=\"code-classlanguage-textrdbmscode관계형-데이터베이스와-code-classlanguage-textnosqlcode로-명칭되는-비관계형-데이터베이스가-있음\" style=\"position:relative;\"><a href=\"#code-classlanguage-textrdbmscode%EA%B4%80%EA%B3%84%ED%98%95-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4%EC%99%80-code-classlanguage-textnosqlcode%EB%A1%9C-%EB%AA%85%EC%B9%AD%EB%90%98%EB%8A%94-%EB%B9%84%EA%B4%80%EA%B3%84%ED%98%95-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4%EA%B0%80-%EC%9E%88%EC%9D%8C\" aria-label=\"code classlanguage textrdbmscode관계형 데이터베이스와 code classlanguage textnosqlcode로 명칭되는 비관계형 데이터베이스가 있음 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">RDBMS</code>(관계형 데이터베이스)와 <code class=\"language-text\">NoSQL</code>로 명칭되는 비관계형 데이터베이스가 있음</h2>\n</li>\n</ul>\n<h2 id=\"database를-사용하는-이유\" style=\"position:relative;\"><a href=\"#database%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0\" aria-label=\"database를 사용하는 이유 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Database를 사용하는 이유?</h2>\n<ol>\n<li>\n<p>데이터를 오랜기간 저장 및 보존</p>\n<blockquote>\n<p>어플리케이션에서는 데이터가 메모리상에 존재하고 <strong>메모리에 존재하는 데이터는 보존이 되지 않기 때문</strong>에 종료되면 메모리에 있던 데이터들은 다시 읽어들일 수 없어서 데이터를 <strong>오랜기간 저장 및 보존하기 위해</strong></p>\n</blockquote>\n</li>\n<li>\n<p>데이터를 체계적으로 보존하고 관리하기 위해 사용</p>\n<blockquote>\n<p>내가 원하는 자료를 쉽게 읽어낼 수 있어야만 의미 있는 정보기 때문</p>\n</blockquote>\n</li>\n</ol>\n<hr>\n<h2 id=\"rdbms-relational-database-management-system\" style=\"position:relative;\"><a href=\"#rdbms-relational-database-management-system\" aria-label=\"rdbms relational database management system permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RDBMS (Relational DataBase Management System)</h2>\n<ul>\n<li><code class=\"language-text\">관계형 데이터 모델</code>에 기초를 둔 데이터베이스 시스템을 말함 (MySQL, Postgres, Oracle DB등)</li>\n<li><code class=\"language-text\">관계형 데이터</code>란 데이터를 서로 상호 관련성을 가진 형태로 표현한 데이터</li>\n<li>\n<p>모든 데이터들은 2차원 테이블로 표현가능</p>\n<blockquote>\n<table>\n<thead>\n<tr>\n<th>Primary Key (id)</th>\n<th>name</th>\n<th>team</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>Lewis Hamilton</td>\n<td>Mercedes</td>\n</tr>\n<tr>\n<td>2</td>\n<td>Max Verstappen</td>\n<td>Redbull</td>\n</tr>\n<tr>\n<td>3</td>\n<td>Charles Leclerc</td>\n<td>Ferrari</td>\n</tr>\n<tr>\n<td>4</td>\n<td>Daniel Ricciardo</td>\n<td>Mclaren</td>\n</tr>\n<tr>\n<td>5</td>\n<td>George Russel</td>\n<td>Williams</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>각각의 테이블은 column과 row로 구성되어 있음</li>\n<li>column은 테이블의 각 항목(<code class=\"language-text\">id</code>, <code class=\"language-text\">name</code>, <code class=\"language-text\">team</code>)</li>\n<li>row는 각 항목들의 실제 값(<code class=\"language-text\">Lewis Hamilton</code>, <code class=\"language-text\">Daniel Ricciardo</code>, <code class=\"language-text\">Ferrari</code>)</li>\n<li>각 row는 자신만의 고유 키 (<code class=\"language-text\">Primary Key</code>)가 있고 고유 키를 통해서 해당 row를 찾거나 인용(<code class=\"language-text\">reference</code>)하게 됨</li>\n</ul>\n</blockquote>\n</li>\n</ul>\n<hr>\n<h3 id=\"rdbms에서-테이블끼리의-연결-종류\" style=\"position:relative;\"><a href=\"#rdbms%EC%97%90%EC%84%9C-%ED%85%8C%EC%9D%B4%EB%B8%94%EB%81%BC%EB%A6%AC%EC%9D%98-%EC%97%B0%EA%B2%B0-%EC%A2%85%EB%A5%98\" aria-label=\"rdbms에서 테이블끼리의 연결 종류 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RDBMS에서 테이블끼리의 연결 종류</h3>\n<h4 id=\"1-one-to-one\" style=\"position:relative;\"><a href=\"#1-one-to-one\" aria-label=\"1 one to one permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1) One to One</h4>\n<ul>\n<li>테이블 A의 row와 테이블 B의 row가 정확히 일대일 매칭이 되는 관계</li>\n<li>결혼으로 생각하면 남-녀 한 명씩만 결혼을 할 수 있는 것처럼 일대일 매칭</li>\n<li>One to One 관계에서는 pk, fk가 어느쪽에 있던 문제는 되지 않음</li>\n</ul>\n<h4 id=\"2-one-to-many\" style=\"position:relative;\"><a href=\"#2-one-to-many\" aria-label=\"2 one to many permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2) One to Many</h4>\n<p>테이블 A의 row가 테이블 B의 여러 row와 연결이 되는 관계\n부모-자식간의 관계로 생각하면 쉽다\n부모 입장에서는 여러 명의 자녀를 가질 수 있으나 자녀 입장에서는 부모가 하나</p>\n<h4 id=\"3-many-to-many\" style=\"position:relative;\"><a href=\"#3-many-to-many\" aria-label=\"3 many to many permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3) Many to Many</h4>\n<p>테이블 A의 여러 row가 테이블 B의 여러 row와 연결이 되는 관계\n서로가 서로를 1:N 관계로 보고 있는 것\n학원과 학생의 관계를 생각해 보면 한 학원에는 여러명의 수강생이 있고 수강생도 여러 학원을 수강할 수 있으므로 N:M관계를 가진다고 할 수 있음</p>\n<hr>\n<h3 id=\"테이블과-테이블을-연결하는-방법\" style=\"position:relative;\"><a href=\"#%ED%85%8C%EC%9D%B4%EB%B8%94%EA%B3%BC-%ED%85%8C%EC%9D%B4%EB%B8%94%EC%9D%84-%EC%97%B0%EA%B2%B0%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\" aria-label=\"테이블과 테이블을 연결하는 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>테이블과 테이블을 연결하는 방법</h3>\n<ul>\n<li>\n<p><code class=\"language-text\">Foreign key</code>(외부키)라는 개념을 사용하여 주로 연결함</p>\n<blockquote>\n<p>다른 테이블의 <code class=\"language-text\">Primary key</code>를 참조</p>\n</blockquote>\n</li>\n</ul>\n<hr>\n<h3 id=\"테이블들을-연결하는-이유\" style=\"position:relative;\"><a href=\"#%ED%85%8C%EC%9D%B4%EB%B8%94%EB%93%A4%EC%9D%84-%EC%97%B0%EA%B2%B0%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0\" aria-label=\"테이블들을 연결하는 이유 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>테이블들을 연결하는 이유?</h3>\n<p>정보들을 왜 여러 테이블에 나누어서 저장할까? 그냥 하나의 테이블에 전부다 저장하면 안되는 것일까?</p>\n<blockquote>\n<ul>\n<li>하나의 테이블에 모든 정보를 다 넣으면 동일한 정보들이 불필요하게 중복되어 저장되어 더 많은 디스크를 사용 및 잘못된 데이터가 저장 될 가능성이 높아짐</li>\n<li>서로 같은 데이터이지만 부분적으로 내용이 다른 데이터가 생기는 문제가 없어짐</li>\n<li>이것을 <code class=\"language-text\">normalization(정규화)</code>라고 함</li>\n</ul>\n</blockquote>\n<hr>\n<h3 id=\"acidatomicity-consistency-isolation-durability\" style=\"position:relative;\"><a href=\"#acidatomicity-consistency-isolation-durability\" aria-label=\"acidatomicity consistency isolation durability permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ACID(Atomicity, Consistency, Isolation, Durability)</h3>\n<ul>\n<li>\n<p><code class=\"language-text\">Atomicity(원자성)</code>은 트랜잭션과 관련된 작업들이 부분적으로 실행되다가 중단되지 않는 것을 보장하는 능력</p>\n<blockquote>\n<p>Ex) 자금 이체시 출금만 성공하고 상대 계좌로 입금되는 작업이 실패해서는 안되는 것</p>\n</blockquote>\n</li>\n<li>\n<p><code class=\"language-text\">Consistency(일관성)</code>은 트랜잭션이 실행을 성공적으로 완료하면 언제나 일관성 있는 데이터베이스 상태로 유지하는 것을 의미</p>\n<blockquote>\n<p>Ex) 위 송금 예제에서 금액의 데이터 타입이 <code class=\"language-text\">int</code>인데 갑자기 <code class=\"language-text\">str</code>이 되지 않는 것</p>\n</blockquote>\n</li>\n<li>\n<p><code class=\"language-text\">Isolation(고립성)</code>은 트랜잭션을 수행 시 다른 트랜잭션의 연산 작업이 끼어들지 못하도록 보장하는 것을 의미</p>\n<blockquote>\n<p>트랜잭션끼리는 서로를 간섭할 수 없음</p>\n</blockquote>\n</li>\n<li>\n<p><code class=\"language-text\">Durability(지속성)</code>은 성공적으로 수행 된 트랜잭션은 영원히 반영되어야 함을 의미</p>\n<blockquote>\n<p>commit이후에 컴퓨터가 꺼지면 데이터는 이미 저장되었으므로 보존되지만 commit전에 컴퓨터가 꺼지게 된다면 데이터는 <code class=\"language-text\">Atomicity</code>원칙을 따라 트랜잭션을 수행하기 전으로 돌아감</p>\n</blockquote>\n</li>\n</ul>\n<hr>\n<h3 id=\"commit--rollback\" style=\"position:relative;\"><a href=\"#commit--rollback\" aria-label=\"commit  rollback permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Commit &#x26; Rollback</h3>\n<h4 id=\"commit\" style=\"position:relative;\"><a href=\"#commit\" aria-label=\"commit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Commit</h4>\n<p>변경된 데이터를 테이블에 영구적으로 반영하는 것</p>\n<ul>\n<li>commit전에는 메모리 buffer에만 영향을 받았기 때문에 데이터의 변경 이전 상태로 복구 가능</li>\n<li>commit후에는 변경사항이 데이터베이스에 반영되고 이전 데이터는 영원히 잃어버리게 됨</li>\n<li>commit이전에 다른 사용자는 현재 사용자가 수행한 명령의 결과를 볼 수 없고 commit이후에 모든 사용자가 결과를 확인 가능</li>\n<li>commit이전에 변경된 행은 locking이 설정되어 다른 사용자가 변경 불가</li>\n</ul>\n<h4 id=\"rollback\" style=\"position:relative;\"><a href=\"#rollback\" aria-label=\"rollback permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Rollback</h4>\n<p>테이블 내에 입력한 데이터, 수정한 데이터, 삭제한 데이터에 대해 commit이전에는 변경사항을 취소할 수 있는데 Rollback기능으로 취소할 수 있다.</p>\n<ul>\n<li>Rollback은 데이터 변경 사항이 취소되어 데이터의 이전 상태로 복구되며, 관련된 행에 대한 locking이 풀리고 다른 사용자들이 데이터 변경을 할 수 있게 됨을 의미</li>\n</ul>\n<hr>\n<p>잘못된 정보는 댓글로 Feedback 부탁드립니다!\n<br><br><br><br><br></p>\n<hr>\n<p>ref.</p>\n<p><a href=\"https://velog.io/@gillog/DB-11-1N-NM-%EA%B4%80%EA%B3%84\">https://velog.io/@gillog/DB-11-1N-NM-%EA%B4%80%EA%B3%84</a></p>\n<p><a href=\"https://victorydntmd.tistory.com/129\">https://victorydntmd.tistory.com/129</a></p>\n<p><a href=\"https://ko.wikipedia.org/wiki/ACID\">https://ko.wikipedia.org/wiki/ACID</a></p>\n<p><a href=\"https://hoon93.tistory.com/24\">https://hoon93.tistory.com/24</a></p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#database%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0\">Database를 사용하는 이유?</a></li>\n<li>\n<p><a href=\"#rdbms-relational-database-management-system\">RDBMS (Relational DataBase Management System)</a></p>\n<ul>\n<li>\n<p><a href=\"#rdbms%EC%97%90%EC%84%9C-%ED%85%8C%EC%9D%B4%EB%B8%94%EB%81%BC%EB%A6%AC%EC%9D%98-%EC%97%B0%EA%B2%B0-%EC%A2%85%EB%A5%98\">RDBMS에서 테이블끼리의 연결 종류</a></p>\n<ul>\n<li><a href=\"#1-one-to-one\">1) One to One</a></li>\n<li><a href=\"#2-one-to-many\">2) One to Many</a></li>\n<li><a href=\"#3-many-to-many\">3) Many to Many</a></li>\n</ul>\n</li>\n<li><a href=\"#%ED%85%8C%EC%9D%B4%EB%B8%94%EA%B3%BC-%ED%85%8C%EC%9D%B4%EB%B8%94%EC%9D%84-%EC%97%B0%EA%B2%B0%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\">테이블과 테이블을 연결하는 방법</a></li>\n<li><a href=\"#%ED%85%8C%EC%9D%B4%EB%B8%94%EB%93%A4%EC%9D%84-%EC%97%B0%EA%B2%B0%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0\">테이블들을 연결하는 이유?</a></li>\n<li><a href=\"#acidatomicity-consistency-isolation-durability\">ACID(Atomicity, Consistency, Isolation, Durability)</a></li>\n<li>\n<p><a href=\"#commit--rollback\">Commit &#x26; Rollback</a></p>\n<ul>\n<li><a href=\"#commit\">Commit</a></li>\n<li><a href=\"#rollback\">Rollback</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"September 21, 2021","title":"Database","categories":"Database","author":"이준영","emoji":"📡"},"fields":{"slug":"/about-database/"}},"prev":null,"site":{"siteMetadata":{"siteUrl":"http://pratiable.github.io","comments":{"utterances":{"repo":"Pratiable/Pratiable.github.io"}}}}},"pageContext":{"slug":"/nest-unittest-using-jest-1/","nextSlug":"/about-database/","prevSlug":""}},"staticQueryHashes":["1073350324","2938748437"]}